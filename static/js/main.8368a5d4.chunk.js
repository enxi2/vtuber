(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{76:function(e,t,n){},79:function(e,t,n){},81:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(13),s=n.n(a),i=n(7),l=n(9),o=n(35),u=n.n(o),j=n(58),b=n(19),d=n(27),h=n(65),f=n(60),m=n(28),O=n(44),v=n(37),x=n(52),p=n(42),g=n(66),k=n(63),N=n(26),C=n(16),T=n(64),I=n.n(T),w=n(61),S=n(67),P=n(2);function y(e){var t=e.children,n=e.className,r=void 0===n?"":n,c=Object(S.a)(e,["children","className"]);return Object(P.jsx)("span",Object(w.a)(Object(w.a)({className:"material-icons ".concat(r)},c),{},{children:t}))}n(76);var E={label:"Select / Deselect All",value:"all",children:[{label:"Hololive",value:"hololive",children:[{label:"Hololive EN",value:"hololive en"},{label:"Hololive IND",value:"hololive ind"},{label:"Hololive JP",value:"hololive jp"},{label:"Holostars",value:"holostars"}]},{label:"Nijisanji",value:"nijisanji",children:[{label:"Nijisanji EN",value:"nijisanji en"},{label:"Nijisanji JP",value:"nijisanji jp"},{label:"Nijisanji ID",value:"nijisanji id"},{label:"Nijisanji KR",value:"nijisanji kr"}]},{label:"VOMS",value:"voms"},{label:"Independent",value:"independent"}]};function L(e,t,n){var r=[];if(r.push(t(e,null!==n&&void 0!==n?n:null)),null!=e.children){var c,a=Object(k.a)(e.children);try{for(a.s();!(c=a.n()).done;){var s=c.value;r.push.apply(r,Object(g.a)(L(s,t,e)))}}catch(i){a.e(i)}finally{a.f()}}return r}function D(e){var t=e.show,n=e.handleClose,c=e.notificationPermission,a=e.showNotification,s=e.setSearch,l=Object(r.useState)([]),o=Object(i.a)(l,2),u=o[0],j=o[1],b=Object(r.useState)(["all"]),d=Object(i.a)(b,2),h=d[0],f=d[1],m=Object(r.useCallback)((function(e){j(e);var t=new Set(e),n=L(E,(function(e,n){return!t.has(e.value)||null!=n&&t.has(n.value)?null:e.value})).filter((function(e){return null!=e}));0===n.length||"all"===n[0]?s(""):s('g:"'.concat(n.join(","),'"'))}),[s]),O=Object(r.useCallback)((function(e){f(e)}),[]);return Object(P.jsxs)(C.a,{className:"about-modal",show:t,onHide:n,children:[Object(P.jsx)(C.a.Header,{closeButton:!0,children:Object(P.jsx)(C.a.Title,{children:"VTuber Streams"})}),Object(P.jsxs)(C.a.Body,{children:[Object(P.jsx)("p",{children:"A page to check, search, and get notifications about VTuber streams."}),Object(P.jsxs)("ul",{children:[Object(P.jsxs)("li",{children:[Object(P.jsx)(y,{children:"star_outline"})," to bookmark a VTuber"]}),Object(P.jsxs)("li",{children:[Object(P.jsx)(y,{children:"notifications_none"})," to receive notifications for a VTuber (native notifications are"," ",Object(P.jsx)("b",{children:"granted"===c?"allowed":"blocked"}),","," ",Object(P.jsx)(N.a,{className:"align-baseline",onClick:function(){return a("Test notification","This is a test notification","#","".concat("/vtuber","/placeholder.png"))},variant:"outline-primary",children:"test notification"}),")"]}),Object(P.jsxs)("li",{children:[Object(P.jsx)("b",{children:"Clear Data"})," will clear all data on this website"]})]}),Object(P.jsx)("p",{children:"First time? Choose some groups to get started:"}),Object(P.jsx)(I.a,{id:"groups-checkbox-tree",nodes:[E],checked:u,checkModel:"all",expanded:h,icons:{check:Object(P.jsx)(y,{children:"check_box"}),uncheck:Object(P.jsx)(y,{children:"check_box_outline_blank"}),halfCheck:Object(P.jsx)(y,{children:"indeterminate_check_box"}),expandClose:Object(P.jsx)(y,{children:"chevron_right"}),expandOpen:Object(P.jsx)(y,{children:"expand_more"}),expandAll:null,collapseAll:null,parentClose:null,parentOpen:null,leaf:null},onCheck:m,onExpand:O,showNodeIcon:!1}),Object(P.jsxs)("p",{children:["Questions or feedback =>"," ",Object(P.jsx)("a",{href:"https://discordapp.com/users/659617582298562570",target:"_blank",rel:"noreferrer",children:"enxi#0410"})]})]}),Object(P.jsx)(C.a.Footer,{children:Object(P.jsx)(N.a,{variant:"primary",onClick:n,children:"Close"})})]})}var _;n(79);function A(e,t){return null==e.endTime&&t.valueOf()>e.startTime.getTime()?_.LIVE:t.valueOf()>=e.startTime.getTime()?_.ENDED:_.UPCOMING}function B(e){for(var t=0,n=0;n<e.length;n++)'"'===e.charAt(n)&&t++;return t}function V(e){return function(e){for(var t=e.split(" "),n=[],r=0,c=0;c<t.length;c++)r%2===1?n[n.length-1]+=" "+t[c].replaceAll('"',""):n.push(t[c].replaceAll('"',"")),r+=B(t[c]);return n}(e).map((function(e){return function(e){var t=e.toLowerCase();if(t.startsWith("v:")){var n=t.substring(2);return{matches:function(e,t){var r=t.get(e.vtuberId);return null!=r&&(r.name.toLowerCase().includes(n)||r.romanizedName.toLowerCase().includes(n))}}}if(t.startsWith("g:")){var r=t.substring(2).split(",");return{matches:function(e,t){var n=t.get(e.vtuberId);return null!=n&&r.some((function(e){return n.groupName.toLowerCase().includes(e)}))}}}return"bookmark"===t||"bookmarks"===t?{matches:function(e,t,n){var r=t.get(e.vtuberId);return null!=r&&n.has(r.vtuberId)}}:"notification"===t||"notifications"===t?{matches:function(e,t,n,r){var c=t.get(e.vtuberId);return null!=c&&r.has(c.vtuberId)}}:{matches:function(e,n){var r=n.get(e.vtuberId);return e.title.toLowerCase().includes(t)||e.vtuberId.toLowerCase().includes(t)||null!=r&&(r.name.toLowerCase().includes(t)||r.romanizedName.toLowerCase().includes(t))}}}(e)})).filter((function(e){return null!=e}))}function M(e){var t=e.now,n=e.streams,c=e.vtubers,a=e.bookmarks,s=e.setBookmarks,l=e.notifications,o=e.setNotifications,j=e.filterPref,d=e.setScrollToCurrentStream,h=Object(r.useRef)(null),f=Object(r.useState)(!0),m=Object(i.a)(f,2),O=m[0],v=m[1],p=Object(r.useMemo)((function(){var e=V(j.get("search"));return n.valueSeq().filter((function(t){return e.every((function(e){return e.matches(t,c,a,l)}))})).toList()}),[a,j,l,n,c]),g=Object(r.useMemo)((function(){return p.valueSeq().sort((function(e,n){var r,c,a=A(e,t),s=A(n,t);return a!==s?a<s?-1:1:a===_.ENDED?(null!==(r=e.endTime)&&void 0!==r?r:e.startTime).getTime()-(null!==(c=n.endTime)&&void 0!==c?c:n.startTime).getTime():e.startTime.getTime()-n.startTime.getTime()})).toList()}),[p,t]),k=Object(r.useMemo)((function(){var e;return null!==(e=g.find((function(e){return null==e.endTime&&t.valueOf()>e.startTime.getTime()||t.valueOf()<e.startTime.getTime()})))&&void 0!==e?e:null}),[t,g]),N=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null!=h.current&&null!=k){var t=document.getElementById(k.streamId);if(null!=t)return t.scrollIntoView(e?{behavior:"smooth"}:void 0),!0}return!1}),[k]);Object(r.useEffect)((function(){d((function(){return N}))}),[N,d]);var C=Object(r.useMemo)((function(){return g.map((function(e){var n,r=e.vtuberId,i=c.get(r);if(null==i)return null;var j=a.has(r),d=l.has(r),h=u()(e.startTime),f=null!=e.endTime?u()(e.endTime):null,m=A(e,t);return Object(P.jsxs)(x.a,{id:e.streamId,className:"stream-item d-flex flex-row m-0 py-2 ".concat(_[m].toLowerCase()," ").concat((null===k||void 0===k?void 0:k.streamId)===e.streamId?"next-stream":""),children:[Object(P.jsxs)(b.a,{xs:2,md:1,className:"stream-toggles text-center",children:[Object(P.jsx)("div",{className:"toggle-bookmark ".concat(j?"active":""),onClick:function(){return s(j?a.remove(r):a.add(r))},children:Object(P.jsx)(y,{children:j?"star":"star_outline"})}),Object(P.jsx)("br",{}),Object(P.jsx)("div",{className:"toggle-notification ".concat(d?"active":""),onClick:function(){return o(d?l.remove(r):l.add(r))},children:Object(P.jsx)(y,{children:d?"notifications_active":"notifications_none"})})]}),Object(P.jsx)(b.a,{xs:4,md:2,lg:1,className:"stream-vtuber p-0",children:Object(P.jsxs)("a",{href:i.link,children:[Object(P.jsx)("img",{src:i.thumbnail,alt:i.name}),Object(P.jsx)("br",{}),i.shortName]})}),Object(P.jsx)(b.a,{xs:6,md:3,lg:2,className:"stream-info p-0 text-center",children:Object(P.jsx)("a",{href:e.link,target:"_blank",rel:"noreferrer",children:Object(P.jsx)("img",{src:null!==(n=e.thumbnail)&&void 0!==n?n:"".concat("/vtuber","/placeholder.png"),alt:"Video thumbnail"})})}),Object(P.jsx)(b.a,{xs:12,md:6,className:"stream-title px-4 px-md-0 py-2 text-center text-md-left",children:Object(P.jsx)("a",{href:e.link,target:"_blank",rel:"noreferrer",children:e.title})}),Object(P.jsxs)(b.a,{xs:12,lg:2,className:"stream-time p-0 text-center",children:[h.format("h:mm A")," ",Object(P.jsx)("br",{className:"d-none d-lg-inline"}),Object(P.jsx)("i",{children:null!=f?"ended ".concat(f.from(t)):m===_.LIVE?"started ".concat(h.from(t)):"starting ".concat(h.from(t))})]})]},e.streamId)}))}),[a,s,l,o,k,t,g,c]);return Object(r.useEffect)((function(){O&&g.count()>0&&N()&&v(!1)}),[O,N,g]),Object(P.jsx)("div",{className:"list-schedule",ref:h,children:C})}function H(e){var t=e.show,n=e.handleClose;return Object(P.jsxs)(C.a,{className:"search-help-modal",show:t,onHide:n,children:[Object(P.jsx)(C.a.Header,{closeButton:!0,children:Object(P.jsx)(C.a.Title,{children:"Search Help"})}),Object(P.jsxs)(C.a.Body,{children:[Object(P.jsx)("p",{children:"Use the search to filter for VTubers and streams. The following case-insensitive search terms are supported:"}),Object(P.jsxs)("ul",{children:[Object(P.jsxs)("li",{children:["General search terms such as ",Object(P.jsx)("code",{children:"pikamee"})," or"," ",Object(P.jsx)("code",{children:"supachat"})," filter both VTuber and video titles."]}),Object(P.jsxs)("li",{children:["Terms with spaces require surrounding quotes, such as"," ",Object(P.jsx)("code",{children:'"super chat"'}),"."]}),Object(P.jsxs)("li",{children:["Specific VTubers can be searched using the ",Object(P.jsx)("code",{children:"v:"})," prefix, such as ",Object(P.jsx)("code",{children:"v:pikamee"}),"."]}),Object(P.jsxs)("li",{children:["Specific groups can be searched using the ",Object(P.jsx)("code",{children:"g:"})," prefix. The supported groups are:",Object(P.jsxs)("ul",{children:[Object(P.jsx)("li",{children:Object(P.jsx)("code",{children:"g:hololive"})}),Object(P.jsx)("li",{children:Object(P.jsx)("code",{children:"g:voms"})})]})]}),Object(P.jsxs)("li",{children:["Save searches using the ",Object(P.jsx)(y,{children:"playlist_add"})," button."]})]})]}),Object(P.jsx)(C.a.Footer,{children:Object(P.jsx)(N.a,{variant:"primary",onClick:n,children:"Close"})})]})}!function(e){e[e.ENDED=0]="ENDED",e[e.LIVE=1]="LIVE",e[e.UPCOMING=2]="UPCOMING"}(_||(_={}));n(80);function J(e,t){var n=Object(r.useState)(function(e,t){var n=localStorage.getItem(e);if(null!=n)try{var r=JSON.parse(n);for(var c in r)Array.isArray(r[c])&&(r[c]=Object(l.a)(r[c]));return t(r)}catch(a){return t()}return t()}(e,t)),c=Object(i.a)(n,2),a=c[0],s=c[1];return[a,Object(r.useCallback)((function(t){localStorage.setItem(e,JSON.stringify(t.toJSON())),s(t)}),[e]),Object(r.useCallback)((function(){localStorage.removeItem(e),s(t())}),[t,e])]}function z(e){var t=Object(r.useState)(function(e){var t=localStorage.getItem(e);if(null!=t)try{return Object(l.e)(JSON.parse(t))}catch(n){console.error(n)}return Object(l.e)()}(e)),n=Object(i.a)(t,2),c=n[0],a=n[1];return[c,Object(r.useCallback)((function(t){localStorage.setItem(e,JSON.stringify(t.toArray())),a(t)}),[e])]}var U=[{name:"UTC",identifier:"UTC",offset:0},{name:"PDT",identifier:"America/Los_Angeles",offset:480}];var q={firstTime:!0,timezone:function(){var e=(new Date).getTimezoneOffset(),t=U.reduce((function(t,n){return Math.abs(e-n.offset)<Math.abs(e-t.offset)?n:t}));return null!=t?t:U[0]}(),nameDisplay:"original"},F={search:"",savedSearches:Object(l.a)()},G=Object(l.d)(q),R=Object(l.d)(F),K=Object(l.d)({sortBy:"next stream"});var W=new URLSearchParams(window.location.search);function Q(){var e=Object(r.useState)(Object(l.b)()),t=Object(i.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(Object(l.c)()),s=Object(i.a)(a,2),o=s[0],u=s[1],j=Object(r.useState)(Object(l.b)()),b=Object(i.a)(j,2),d=b[0],h=b[1],f=Object(r.useCallback)((function(e){var t=function(){switch(W.get("source")){case"local":return"./data/latest.json";default:return"https://vtuber-streams-data.herokuapp.com/latest.json"}}();fetch(t,{cache:"no-cache"}).then((function(e){return e.json()})).then((function(e){c(e.vtubers.reduce((function(e,t){return e.has(t.vtuberId)?e:e.set(t.vtuberId,t)}),Object(l.b)()));var t=e.streams.reduce((function(e,t){return e.has(t.streamId)?e:e.set(t.streamId,function(e){return{streamId:e.streamId,vtuberId:e.vtuberId,source:e.source,title:e.title,link:e.link,thumbnail:e.thumbnail,startTime:new Date(e.startTime),endTime:null!=e.endTime?new Date(e.endTime):null,membership:1===e.membership}}(t))}),Object(l.c)());u(t),h(t.valueSeq().groupBy((function(e){return e.vtuberId})).map((function(e){return e.toList()})).toMap())})).catch((function(e){return console.error(e)}))}),[]);return Object(r.useEffect)((function(){f();var e=Date.now(),t=setInterval((function(){f(e),e=Date.now()}),6e4);return function(){return clearInterval(t)}}),[f]),{vtubers:n,streams:o,streamsByVtuber:d}}n(81),n(82);var X=function(){return u.a.tz(void 0,u.a.tz.guess())};var Y=function(){var e=Object(r.useState)(!1),t=Object(i.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(!1),s=Object(i.a)(a,2),o=s[0],u=s[1],g=Object(r.useRef)(null),k=Object(r.useState)(null),N=Object(i.a)(k,2),C=N[0],T=N[1],I=Object(r.useRef)(Object(l.b)()),w=function(e,t,n){var c=Object(r.useState)(n),a=Object(i.a)(c,2),s=a[0],l=a[1];return Object(r.useEffect)((function(){var n=setInterval((function(){var t=e();s!==t&&l(t)}),t);return function(){return clearInterval(n)}}),[e,t,s]),s}(X,1e4,X()),S=function(){var e=J("site",G),t=Object(i.a)(e,3),n=t[0],c=t[1],a=t[2],s=J("filter",R),o=Object(i.a)(s,3),u=o[0],j=o[1],b=o[2],d=J("sort",K),h=Object(i.a)(d,3),f=h[0],m=h[1],O=h[2],v=z("bookmarks"),x=Object(i.a)(v,2),p=x[0],g=x[1],k=z("notifications"),N=Object(i.a)(k,2),C=N[0],T=N[1];return{sitePref:n,setSitePref:c,filterPref:u,setFilterPref:j,sortPref:f,setSortPref:m,reset:Object(r.useCallback)((function(){a(),b(),O(),g(Object(l.e)()),T(Object(l.e)())}),[a,b,O,g,T]),bookmarks:p,setBookmarks:g,notifications:C,setNotifications:T}}(),E=S.sitePref,L=S.setSitePref,_=S.filterPref,A=S.setFilterPref,B=S.reset,V=S.bookmarks,U=S.setBookmarks,q=S.notifications,F=S.setNotifications,W=function(){var e=Object(r.useState)("default"),t=Object(i.a)(e,2),n=t[0],c=t[1],a=Object(r.useCallback)((function(e,t,r,c){null!=window.Notification&&"granted"===n?new window.Notification(e,{body:t,icon:c}):Object(p.c)(Object(P.jsxs)("div",{className:"notification-toast",children:[Object(P.jsx)("img",{alt:"".concat(e," notification icon"),src:c}),Object(P.jsxs)("div",{children:[Object(P.jsx)("h1",{children:e}),Object(P.jsx)("p",{children:Object(P.jsx)("a",{href:r,rel:"noreferrer",target:"_blank",children:t})})]})]},r))}),[n]),s=Object(r.useCallback)((function(e){c(e)}),[]);return Object(r.useEffect)((function(){null!=window.Notification&&window.Notification.requestPermission().then((function(e){s(e)}))}),[s]),{notificationPermission:n,showNotification:a}}(),Y=W.notificationPermission,Z=W.showNotification,$=Q(),ee=$.vtubers,te=$.streams,ne=Object(r.useMemo)((function(){return _.get("search")}),[_]),re=Object(r.useCallback)((function(e){return A(_.set("search",e))}),[_,A]),ce=Object(r.useCallback)((function(){window.confirm("Press OK to clear all bookmarks, filters, etc. from this web page.")&&B()}),[B]),ae=Object(r.useCallback)((function(e){return re(e.target.value)}),[re]),se=Object(r.useMemo)((function(){return _.get("savedSearches")}),[_]),ie=Object(r.useCallback)((function(){var e=ne.trim();e.length>0&&!se.contains(e)&&A(_.set("savedSearches",se.push(e)))}),[se,ne,_,A]),le=Object(r.useCallback)((function(e){A(_.set("savedSearches",se.remove(e)))}),[se,_,A]);return Object(r.useEffect)((function(){I.current=te.reduce((function(e,t){if(e.has(t.streamId)){if("before"===e.get(t.streamId)&&w.isAfter(t.startTime)){var n,r=ee.get(t.vtuberId);if(q.has(r.vtuberId))Z("".concat(r.shortName,"'s stream is starting!"),t.title,t.link,null!==(n=t.thumbnail)&&void 0!==n?n:r.thumbnail);return e.set(t.streamId,"after")}return e}return e.set(t.streamId,w.isBefore(t.startTime)?"before":"after")}),I.current)}),[q,w,Z,te,ee]),Object(r.useEffect)((function(){E.get("firstTime")&&(c(!0),L(E.set("firstTime",!1)))}),[E,L]),Object(P.jsxs)("div",{className:"app d-flex flex-column h-100",children:[Object(P.jsx)(v.a,{expand:"md",children:Object(P.jsxs)(j.a,{className:"px-0 px-md-1",children:[Object(P.jsx)(v.a.Brand,{children:"VTuber Streams"}),Object(P.jsx)(v.a.Text,{className:"d-none d-sm-inline-block",children:w.format("h:mm A z")}),Object(P.jsx)(v.a.Toggle,{"aria-controls":"navbar"}),Object(P.jsx)(v.a.Collapse,{id:"navbar",children:Object(P.jsxs)(O.a,{className:"ml-auto",children:[Object(P.jsx)(O.a.Link,{className:"d-sm-none",href:"#",onClick:function(){return u(!0)},children:"Search Help"}),Object(P.jsx)(O.a.Link,{href:"#",onClick:ce,children:"Clear Data"}),Object(P.jsx)(O.a.Link,{href:"#",onClick:function(){return c(!0)},children:"About"})]})})]})}),Object(P.jsx)(j.a,{className:"filters px-3 px-sm-0",children:Object(P.jsx)(x.a,{children:Object(P.jsx)(f.a.Group,{as:b.a,className:"m-0",children:Object(P.jsxs)(m.a,{className:"mb-2 mr-sm-2",children:[Object(P.jsx)(m.a.Prepend,{children:Object(P.jsx)(m.a.Text,{className:"scroll icon-button",onClick:function(){null!=C&&C(!0)},children:Object(P.jsx)("span",{className:"material-icons",children:"update"})})}),Object(P.jsx)(m.a.Prepend,{className:"d-none d-sm-flex",children:Object(P.jsx)(m.a.Text,{className:"search icon-button",onClick:function(){return u(!0)},children:Object(P.jsx)("span",{className:"material-icons",children:"search"})})}),Object(P.jsx)(f.a.Control,{id:"search",placeholder:"v:pikamee title bookmarks",onChange:ae,value:ne}),Object(P.jsx)(m.a.Append,{children:Object(P.jsxs)(h.a,{title:"",menuAlign:"right",variant:"outline-secondary",children:[Object(P.jsx)(d.a.Item,{onClick:ie,children:"Save search"},"save"),Object(P.jsx)(d.a.Item,{onClick:function(){return re("")},children:"Clear search"},"clear"),se.count()>0?se.reverse().map((function(e,t){return Object(P.jsxs)(d.a.Item,{className:"d-flex",onClick:function(){return re(e)},children:[e,Object(P.jsx)("div",{className:"clear-search ml-auto pl-2",children:Object(P.jsx)(y,{onClick:function(e){return le(t),e.stopPropagation(),e.preventDefault(),!1},children:"clear"})},"clear")]},t)})).toJS():Object(P.jsx)(d.a.Header,{children:"No saved searches"})]})})]})})})}),Object(P.jsx)(j.a,{className:"schedule px-0 mt-2",ref:g,children:Object(P.jsx)(M,{now:w,streams:te,vtubers:ee,sitePref:E,filterPref:_,bookmarks:V,setBookmarks:U,notifications:q,setNotifications:F,setScrollToCurrentStream:T})}),Object(P.jsx)(D,{show:n,handleClose:function(){return c(!1)},notificationPermission:Y,showNotification:Z,setSearch:re}),Object(P.jsx)(H,{show:o,handleClose:function(){return u(!1)}}),Object(P.jsx)(p.b,{autoClose:36e5,closeOnClick:!0,draggablePercent:50,hideProgressBar:!0,newestOnTop:!0,pauseOnFocusLoss:!1,position:"top-center",transition:p.a})]})};n(85);s.a.render(Object(P.jsx)(c.a.StrictMode,{children:Object(P.jsx)(Y,{})}),document.getElementById("root"))}},[[86,1,2]]]);
//# sourceMappingURL=main.8368a5d4.chunk.js.map