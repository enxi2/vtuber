(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{55:function(e,t,n){},57:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(14),s=n.n(a),i=n(7),o=n(8),l=n(23),u=n.n(l),b=n(39),j=n(15),d=n(43),f=n(26),m=n(40),h=n(27),O=n(37),x=n(29),v=n(25),p=n(12),g=n(1);function k(e){var t=e.children,n=e.className,r=void 0===n?"":n;return Object(g.jsx)("span",{className:"material-icons ".concat(r),children:t})}function N(e){var t=e.show,n=e.handleClose,c=e.notificationPermission,a=e.showNotification,s=Object(r.useState)(!1),o=Object(i.a)(s,2),l=o[0],u=o[1];return Object(g.jsxs)(p.a,{show:t,onHide:n,children:[Object(g.jsx)(p.a.Header,{closeButton:!0,children:Object(g.jsx)(p.a.Title,{children:"VTuber Streams"})}),Object(g.jsxs)(p.a.Body,{children:[Object(g.jsx)("p",{children:"A page to check, search, and get notifications about VTuber streams."}),Object(g.jsxs)("ul",{children:[Object(g.jsxs)("li",{children:[Object(g.jsx)(k,{children:"star_outline"})," to bookmark a VTuber"]}),Object(g.jsxs)("li",{children:[Object(g.jsx)(k,{children:"notifications_none"})," to receive notifications for a VTuber (notifications are"," ",Object(g.jsx)("b",{children:"granted"===c?"allowed":"blocked"}),","," ",Object(g.jsx)(v.a,{className:"align-baseline",onClick:function(){return a("Test notification","This is a test notification","#","".concat("/vtuber","/placeholder.png"))},variant:"outline-primary",children:"test notification"}),")"]}),Object(g.jsxs)("li",{children:[Object(g.jsx)("b",{children:"Clear Data"})," will clear all data on this website"]})]}),Object(g.jsxs)("p",{children:["Send questions or feedback to"," ",l?Object(g.jsx)("a",{href:"mailto:erin.xi@outlook.com",children:"erin.xi@outlook.com"}):Object(g.jsx)(v.a,{className:"align-baseline",onClick:function(){return u(!0)},variant:"outline-primary",children:"Show Email"})," ","or"," ",Object(g.jsx)("a",{href:"https://discordapp.com/users/659617582298562570",target:"_blank",rel:"noreferrer",children:"enxi#0410"}),"."]})]}),Object(g.jsx)(p.a.Footer,{children:Object(g.jsx)(v.a,{variant:"primary",onClick:n,children:"Close"})})]})}var T;n(55);function w(e,t){return null==e.endTime&&t.valueOf()>e.startTime.getTime()?T.LIVE:t.valueOf()>=e.startTime.getTime()?T.ENDED:T.UPCOMING}function I(e){for(var t=0,n=0;n<e.length;n++)'"'===e.charAt(n)&&t++;return t}function C(e){return function(e){for(var t=e.split(" "),n=[],r=0,c=0;c<t.length;c++)r%2===1?n[n.length-1]+=" "+t[c].replaceAll('"',""):n.push(t[c].replaceAll('"',"")),r+=I(t[c]);return n}(e).map((function(e){return function(e){var t=e.toLowerCase();if(t.startsWith("v:")){var n=t.substring(2);return{matches:function(e,t){var r=t.get(e.vtuberId);return null!=r&&(r.name.toLowerCase().includes(n)||r.romanizedName.toLowerCase().includes(n))}}}return"bookmark"===t||"bookmarks"===t?{matches:function(e,t,n){var r=t.get(e.vtuberId);return null!=r&&n.has(r.vtuberId)}}:"notification"===t||"notifications"===t?{matches:function(e,t,n,r){var c=t.get(e.vtuberId);return null!=c&&r.has(c.vtuberId)}}:{matches:function(e,n){var r=n.get(e.vtuberId);return e.title.toLowerCase().includes(t)||e.vtuberId.toLowerCase().includes(t)||null!=r&&(r.name.toLowerCase().includes(t)||r.romanizedName.toLowerCase().includes(t))}}}(e)})).filter((function(e){return null!=e}))}function S(e){var t=e.streams,n=e.vtubers,c=e.bookmarks,a=e.setBookmarks,s=e.notifications,o=e.setNotifications,l=e.filterPref,b=e.now,d=Object(r.useRef)(null),f=Object(r.useState)(!0),m=Object(i.a)(f,2),h=m[0],x=m[1],v=Object(r.useMemo)((function(){var e=C(l.get("search"));return t.valueSeq().filter((function(t){return e.every((function(e){return e.matches(t,n,c,s)}))})).toList()}),[c,l,s,t,n]),p=Object(r.useMemo)((function(){return v.valueSeq().sort((function(e,t){var n,r,c=w(e,b),a=w(t,b);return c!==a?c<a?-1:1:c===T.ENDED?(null!==(n=e.endTime)&&void 0!==n?n:e.startTime).getTime()-(null!==(r=t.endTime)&&void 0!==r?r:t.startTime).getTime():e.startTime.getTime()-t.startTime.getTime()})).toList()}),[v,b]),N=Object(r.useMemo)((function(){var e;return null!==(e=p.find((function(e){return null==e.endTime&&b.valueOf()>e.startTime.getTime()||b.valueOf()<e.startTime.getTime()})))&&void 0!==e?e:null}),[b,p]),I=Object(r.useCallback)((function(){if(null!=d.current&&null!=N){var e=document.getElementById(N.streamId);if(null!=e)return e.scrollIntoView(),!0}return!1}),[N]),S=Object(r.useMemo)((function(){return p.map((function(e){var t,r=e.vtuberId,i=n.get(r),l=c.has(r),d=s.has(r),f=u()(e.startTime),m=null!=e.endTime?u()(e.endTime):null,h=w(e,b);return Object(g.jsxs)(O.a,{id:e.streamId,className:"stream-item d-flex flex-row m-0 py-2 ".concat(T[h].toLowerCase()," ").concat((null===N||void 0===N?void 0:N.streamId)===e.streamId?"next-stream":""),children:[Object(g.jsxs)(j.a,{xs:2,md:1,className:"stream-toggles text-center",children:[Object(g.jsx)("div",{className:"toggle-bookmark ".concat(l?"active":""),onClick:function(){return a(l?c.remove(r):c.add(r))},children:Object(g.jsx)(k,{children:l?"star":"star_outline"})}),Object(g.jsx)("br",{}),Object(g.jsx)("div",{className:"toggle-notification ".concat(d?"active":""),onClick:function(){return o(d?s.remove(r):s.add(r))},children:Object(g.jsx)(k,{children:d?"notifications_active":"notifications_none"})})]}),Object(g.jsx)(j.a,{xs:4,md:2,lg:1,className:"stream-vtuber p-0",children:Object(g.jsxs)("a",{href:i.link,children:[Object(g.jsx)("img",{src:i.thumbnail,alt:i.name}),Object(g.jsx)("br",{}),i.shortName]})}),Object(g.jsx)(j.a,{xs:6,md:3,lg:2,className:"stream-info p-0 text-center",children:Object(g.jsx)("a",{href:e.link,target:"_blank",rel:"noreferrer",children:Object(g.jsx)("img",{src:null!==(t=e.thumbnail)&&void 0!==t?t:"".concat("/vtuber","/placeholder.png"),alt:"Video thumbnail"})})}),Object(g.jsx)(j.a,{xs:12,md:6,className:"stream-title px-4 px-md-0 py-2 text-center text-md-left",children:Object(g.jsx)("a",{href:e.link,target:"_blank",rel:"noreferrer",children:e.title})}),Object(g.jsxs)(j.a,{xs:12,lg:2,className:"stream-time p-0 text-center",children:[f.format("h:mm A")," ",Object(g.jsx)("br",{className:"d-none d-lg-inline"}),Object(g.jsx)("i",{children:null!=m?"ended ".concat(m.from(b)):h===T.LIVE?"started ".concat(f.from(b)):"starting ".concat(f.from(b))})]})]},e.streamId)}))}),[c,a,s,o,N,b,p,n]);return Object(r.useEffect)((function(){h&&p.count()>0&&I()&&x(!1)}),[h,I,p]),Object(g.jsx)("div",{className:"list-schedule",ref:d,children:S})}function P(e){var t=e.show,n=e.handleClose;return Object(g.jsxs)(p.a,{show:t,onHide:n,children:[Object(g.jsx)(p.a.Header,{closeButton:!0,children:Object(g.jsx)(p.a.Title,{children:"Search Help"})}),Object(g.jsxs)(p.a.Body,{children:[Object(g.jsx)("p",{children:"Use the search to filter for VTubers and streams. The following case-insensitive search terms are supported:"}),Object(g.jsxs)("ul",{children:[Object(g.jsxs)("li",{children:["General search terms such as ",Object(g.jsx)("code",{children:"pikamee"})," or"," ",Object(g.jsx)("code",{children:"superchat"})," filter both VTuber and video titles."]}),Object(g.jsxs)("li",{children:["Terms with spaces require surrounding quotes, such as"," ",Object(g.jsx)("code",{children:'"super chat"'}),"."]}),Object(g.jsxs)("li",{children:["Specific VTubers can be searched using the ",Object(g.jsx)("code",{children:"v:"})," prefix, such as ",Object(g.jsx)("code",{children:"v:pikamee"}),"."]})]})]}),Object(g.jsx)(p.a.Footer,{children:Object(g.jsx)(v.a,{variant:"primary",onClick:n,children:"Close"})})]})}!function(e){e[e.ENDED=0]="ENDED",e[e.LIVE=1]="LIVE",e[e.UPCOMING=2]="UPCOMING"}(T||(T={}));n(56);function y(e,t){var n=Object(r.useState)(function(e,t){var n=localStorage.getItem(e);if(null!=n)try{return t(JSON.parse(n))}catch(r){return t()}return t()}(e,t)),c=Object(i.a)(n,2),a=c[0],s=c[1];return[a,Object(r.useCallback)((function(t){localStorage.setItem(e,JSON.stringify(t.toJSON())),s(t)}),[e]),Object(r.useCallback)((function(){localStorage.removeItem(e),s(t())}),[t,e])]}function E(e){var t=Object(r.useState)(function(e){var t=localStorage.getItem(e);if(null!=t)try{return Object(o.d)(JSON.parse(t))}catch(n){console.error(n)}return Object(o.d)()}(e)),n=Object(i.a)(t,2),c=n[0],a=n[1];return[c,Object(r.useCallback)((function(t){localStorage.setItem(e,JSON.stringify(t.toArray())),a(t)}),[e])]}var L=[{name:"UTC",identifier:"UTC",offset:0},{name:"PDT",identifier:"America/Los_Angeles",offset:480}];var D={timezone:function(){var e=(new Date).getTimezoneOffset(),t=L.reduce((function(t,n){return Math.abs(e-n.offset)<Math.abs(e-t.offset)?n:t}));return null!=t?t:L[0]}(),nameDisplay:"original"},B=Object(o.c)(D),V=Object(o.c)({search:""}),A=Object(o.c)({sortBy:"next stream"});function M(){var e=Object(r.useState)(Object(o.a)()),t=Object(i.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(Object(o.b)()),s=Object(i.a)(a,2),l=s[0],u=s[1],b=Object(r.useState)(Object(o.a)()),j=Object(i.a)(b,2),d=j[0],f=j[1],m=Object(r.useCallback)((function(e){fetch("https://vtuber-streams-data.herokuapp.com/latest.json",{cache:"no-cache"}).then((function(e){return e.json()})).then((function(e){c(e.vtubers.reduce((function(e,t){return e.has(t.vtuberId)?e:e.set(t.vtuberId,t)}),Object(o.a)()));var t=e.streams.reduce((function(e,t){return e.has(t.streamId)?e:e.set(t.streamId,function(e){return{streamId:e.streamId,vtuberId:e.vtuberId,source:e.source,title:e.title,link:e.link,thumbnail:e.thumbnail,startTime:new Date(e.startTime),endTime:null!=e.endTime?new Date(e.endTime):null,membership:1===e.membership}}(t))}),Object(o.b)());u(t),f(t.valueSeq().groupBy((function(e){return e.vtuberId})).map((function(e){return e.toList()})).toMap())})).catch((function(e){return console.error(e)}))}),[]);return Object(r.useEffect)((function(){m();var e=Date.now(),t=setInterval((function(){m(e),e=Date.now()}),6e4);return function(){return clearInterval(t)}}),[m]),{vtubers:n,streams:l,streamsByVtuber:d}}n(57),n(58);var _=function(){return u()()};var q=function(){var e=Object(r.useState)(!1),t=Object(i.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(!1),s=Object(i.a)(a,2),l=s[0],v=s[1],p=Object(r.useRef)(null),k=Object(r.useRef)(Object(o.a)()),T=function(e,t,n){var c=Object(r.useState)(n),a=Object(i.a)(c,2),s=a[0],o=a[1];return Object(r.useEffect)((function(){var n=setInterval((function(){var t=e();s!==t&&o(t)}),t);return function(){return clearInterval(n)}}),[e,t,s]),s}(_,1e4,u()()),w=function(){var e=y("site",B),t=Object(i.a)(e,3),n=t[0],c=t[1],a=t[2],s=y("filter",V),l=Object(i.a)(s,3),u=l[0],b=l[1],j=l[2],d=y("sort",A),f=Object(i.a)(d,3),m=f[0],h=f[1],O=f[2],x=E("bookmarks"),v=Object(i.a)(x,2),p=v[0],g=v[1],k=E("notifications"),N=Object(i.a)(k,2),T=N[0],w=N[1];return{sitePref:n,setSitePref:c,filterPref:u,setFilterPref:b,sortPref:m,setSortPref:h,reset:Object(r.useCallback)((function(){a(),j(),O(),g(Object(o.d)()),w(Object(o.d)())}),[a,j,O,g,w]),bookmarks:p,setBookmarks:g,notifications:T,setNotifications:w}}(),I=w.sitePref,C=w.filterPref,L=w.setFilterPref,D=w.reset,q=w.bookmarks,J=w.setBookmarks,U=w.notifications,F=w.setNotifications,G=function(){var e=Object(r.useState)("default"),t=Object(i.a)(e,2),n=t[0],c=t[1],a=Object(r.useCallback)((function(e,t,r,c){null!=window.Notification&&"granted"===n?new window.Notification(e,{body:t,icon:c}):Object(x.c)(Object(g.jsxs)("div",{className:"notification-toast",children:[Object(g.jsx)("img",{alt:"".concat(e," notification icon"),src:c}),Object(g.jsxs)("div",{children:[Object(g.jsx)("h1",{children:e}),Object(g.jsx)("p",{children:Object(g.jsx)("a",{href:r,rel:"noreferrer",target:"_blank",children:t})})]})]},r))}),[n]),s=Object(r.useCallback)((function(e){c(e)}),[]);return Object(r.useEffect)((function(){null!=window.Notification&&window.Notification.requestPermission().then((function(e){s(e)}))}),[s]),{notificationPermission:n,showNotification:a}}(),H=G.notificationPermission,z=G.showNotification,R=M(),K=R.vtubers,W=R.streams,Q=Object(r.useMemo)((function(){return C.get("search")}),[C]),X=Object(r.useCallback)((function(){window.confirm("Press OK to clear all bookmarks, filters, etc. from this web page.")&&D()}),[D]),Y=Object(r.useCallback)((function(e){L(C.set("search",e.target.value))}),[C,L]);return Object(r.useEffect)((function(){k.current=W.reduce((function(e,t){if(e.has(t.streamId)){if("before"===e.get(t.streamId)&&T.isAfter(t.startTime)){var n,r=K.get(t.vtuberId);if(U.has(r.vtuberId))z("".concat(r.shortName,"'s stream is starting!"),t.title,t.link,null!==(n=t.thumbnail)&&void 0!==n?n:r.thumbnail);return e.set(t.streamId,"after")}return e}return e.set(t.streamId,T.isBefore(t.startTime)?"before":"after")}),k.current)}),[U,T,z,W,K]),Object(g.jsxs)("div",{className:"app d-flex flex-column h-100",children:[Object(g.jsx)(h.a,{expand:"md",children:Object(g.jsxs)(b.a,{className:"px-0 px-md-1",children:[Object(g.jsx)(h.a.Brand,{href:"#",children:"VTuber Streams"}),Object(g.jsx)(h.a.Text,{children:T.format("h:mm A")}),Object(g.jsx)(h.a.Toggle,{"aria-controls":"navbar"}),Object(g.jsx)(h.a.Collapse,{id:"navbar",children:Object(g.jsxs)(m.a,{className:"ml-auto",children:[Object(g.jsx)(m.a.Link,{href:"#",onClick:X,children:"Clear Data"}),Object(g.jsx)(m.a.Link,{href:"#",onClick:function(){return c(!0)},children:"About"})]})})]})}),Object(g.jsx)(b.a,{className:"px-3 px-sm-0",children:Object(g.jsx)(O.a,{children:Object(g.jsx)(d.a.Group,{as:j.a,className:"m-0",children:Object(g.jsxs)(f.a,{className:"mb-2 mr-sm-2",children:[Object(g.jsx)(f.a.Prepend,{children:Object(g.jsx)(f.a.Text,{children:Object(g.jsx)("span",{className:"material-icons",children:"search"})})}),Object(g.jsx)(d.a.Control,{id:"search",placeholder:"v:pikamee title",onChange:Y,value:Q}),Object(g.jsx)(f.a.Append,{children:Object(g.jsx)(f.a.Text,{className:"help",onClick:function(){return v(!0)},children:Object(g.jsx)("span",{className:"material-icons",children:"help_outline"})})})]})})})}),Object(g.jsx)(b.a,{className:"schedule px-0 mt-2",ref:p,children:Object(g.jsx)(S,{streams:W,vtubers:K,sitePref:I,filterPref:C,bookmarks:q,setBookmarks:J,notifications:U,setNotifications:F,now:T})}),Object(g.jsx)(N,{show:n,handleClose:function(){return c(!1)},notificationPermission:H,showNotification:z}),Object(g.jsx)(P,{show:l,handleClose:function(){return v(!1)}}),Object(g.jsx)(x.b,{autoClose:36e5,closeOnClick:!0,draggablePercent:50,hideProgressBar:!0,newestOnTop:!0,pauseOnFocusLoss:!1,position:"top-center",transition:x.a})]})};n(60);s.a.render(Object(g.jsx)(c.a.StrictMode,{children:Object(g.jsx)(q,{})}),document.getElementById("root"))}},[[61,1,2]]]);
//# sourceMappingURL=main.1b02fc36.chunk.js.map